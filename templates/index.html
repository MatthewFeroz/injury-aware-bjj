<!DOCTYPE html>
<html>
<head>
  <title>Injury-Aware BJJ Coach</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 30px; 
      background: #1a1a1a; 
      color: #e0e0e0; 
    }
    h1 { color: #4a9eff; }
    h2 { color: #66b3ff; }
    h3 { color: #80c4ff; }
    p { color: #c0c0c0; }
    form { 
      margin-bottom: 20px; 
      padding: 20px; 
      background: #2d2d2d; 
      border-radius: 8px; 
      border: 1px solid #404040;
    }
    label { 
      color: #e0e0e0; 
      display: block; 
      margin: 8px 0; 
      cursor: pointer;
    }
    input[type="checkbox"] { 
      margin-right: 8px; 
      accent-color: #4a9eff;
    }
    button { 
      padding: 12px 24px; 
      background: linear-gradient(135deg, #4a9eff, #357abd); 
      color: white; 
      border: none; 
      border-radius: 6px; 
      cursor: pointer; 
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    button:hover { 
      background: linear-gradient(135deg, #357abd, #2a5a8a); 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
    }
    .results { 
      display: flex; 
      gap: 40px; 
      margin-top: 20px; 
    }
    .column { 
      width: 45%; 
      padding: 20px; 
      border-radius: 8px; 
      border: 1px solid #404040;
    }
    .unsafe { 
      background: linear-gradient(135deg, #4a1a1a, #3d1515); 
      border-left: 4px solid #ff6b6b;
    }
    .safe { 
      background: linear-gradient(135deg, #1a4a1a, #153d15); 
      border-left: 4px solid #51cf66;
    }
    .ai-section { 
      background: linear-gradient(135deg, #1a2a4a, #15203d); 
      margin-top: 20px; 
      padding: 20px; 
      border-radius: 8px; 
      border: 1px solid #404040;
      border-left: 4px solid #4a9eff;
    }
    .recovery-section { 
      background: linear-gradient(135deg, #4a3a1a, #3d2f15); 
      margin-top: 15px; 
      padding: 20px; 
      border-radius: 8px; 
      border: 1px solid #404040;
      border-left: 4px solid #ffd43b;
    }
    ul { 
      padding-left: 20px; 
      color: #e0e0e0;
    }
    li { 
      margin: 8px 0; 
      color: #e0e0e0;
    }
    .ai-content { 
      white-space: pre-line; 
      line-height: 1.6; 
      color: #e0e0e0;
    }
    .unsafe h3 { color: #ff6b6b; }
    .safe h3 { color: #51cf66; }
    .ai-section h3 { color: #4a9eff; }
    .recovery-section h3 { color: #ffd43b; }
  </style>
</head>
<body>
  <h1>ü§º Injury-Aware BJJ Coach</h1>
  <p>Select your injuries and get personalized safe vs unsafe moves with AI-powered recommendations.</p>

  <form method="POST">
    <label><input type="checkbox" name="injuries" value="ACL reconstruction"> ACL reconstruction</label><br>
    <label><input type="checkbox" name="injuries" value="Meniscus tear"> Meniscus tear</label><br>
    <label><input type="checkbox" name="injuries" value="Shoulder instability"> Shoulder instability</label><br>
    <label><input type="checkbox" name="injuries" value="Labrum tear"> Labrum tear</label><br>
    <label><input type="checkbox" name="injuries" value="Wrist ligament injury"> Wrist ligament injury</label><br>
    <label><input type="checkbox" name="injuries" value="Neck injury"> Neck injury</label><br>
    <label><input type="checkbox" name="injuries" value="Lower back pain"> Lower back pain</label><br>
    <br>
    <button type="submit">Get Recommendations</button>
  </form>

  {% if injuries %}
  <h2>Results for: {{ injuries|join(", ") }}</h2>
  <div class="results">
    <div class="column unsafe">
      <h3>‚ùå Unsafe Moves</h3>
      {% if unsafe_moves %}
      <ul>
        {% for move in unsafe_moves %}
          <li>{{ move }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No unsafe moves found.</p>
      {% endif %}
    </div>

    <div class="column safe">
      <h3>‚úÖ Safe Moves</h3>
      {% if safe_moves %}
      <ul>
        {% for move in safe_moves %}
          <li>{{ move }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p>No safe moves found.</p>
      {% endif %}
    </div>
  </div>
  
  <!-- AI Recommendations Section -->
  {% if ai_recommendations %}
  <div class="ai-section">
    <h3>ü§ñ AI Coach Recommendations</h3>
    <div class="ai-content">{{ ai_recommendations.recommendations }}</div>
  </div>
  {% endif %}

  <div class="ai-section" style="margin-top: 30px;">
    <h3>üí¨ Chat with AI Coach</h3>
    <div id="chat" style="max-width: 800px; padding: 12px; background:#222; border-radius:8px; border:1px solid #404040; margin-bottom:10px; height:220px; overflow:auto"></div>
    <div style="display:flex; gap:8px; max-width:800px;">
      <input id="chat-input" type="text" placeholder="Type your message..." style="flex:1; padding:10px; border-radius:6px; border:1px solid #404040; background:#2d2d2d; color:#e0e0e0" />
      <button id="chat-send">Send</button>
    </div>
  </div>

  <script>
    (function(){
      const chat = document.getElementById('chat');
      const input = document.getElementById('chat-input');
      const send = document.getElementById('chat-send');
      const sessionId = Math.random().toString(36).slice(2);

      function append(role, text) {
        const el = document.createElement('div');
        el.style.margin = '6px 0';
        el.innerHTML = `<b>${role}:</b> ${text.replace(/</g,'&lt;')}`;
        chat.appendChild(el);
        chat.scrollTop = chat.scrollHeight;
      }

      async function postMessage() {
        const msg = input.value.trim();
        if (!msg) return;
        append('You', msg);
        input.value = '';
        try {
          const res = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId, message: msg })
          });
          if (!res.ok) throw new Error('Request failed');
          const data = await res.json();
          append('Coach', data.reply || '(no reply)');
        } catch (e) {
          append('System', 'Error: ' + e.message);
        }
      }

      send.addEventListener('click', postMessage);
      input.addEventListener('keydown', function(e){
        if (e.key === 'Enter') postMessage();
      });
    })();
  </script>
  
  <!-- Recovery Advice Section -->
  {% if recovery_advice %}
  <div class="recovery-section">
    <h3>üè• Recovery & Rehabilitation Advice</h3>
    <div class="ai-content">{{ recovery_advice }}</div>
  </div>
  {% endif %}
  
  {% endif %}
</body>
</html>